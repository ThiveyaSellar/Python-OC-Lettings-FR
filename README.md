## Résumé

Site web d'Orange County Lettings

## Développement local

### Prérequis

- Compte GitHub avec accès en lecture à ce repository
- Git CLI
- SQLite3 CLI
- Interpréteur Python, version 3.6 ou supérieure

Dans le reste de la documentation sur le développement local, il est supposé que la commande `python` de votre OS shell exécute l'interpréteur Python ci-dessus (à moins qu'un environnement virtuel ne soit activé).

### macOS / Linux

#### Cloner le repository

- `cd /path/to/put/project/in`
- `git clone https://github.com/OpenClassrooms-Student-Center/Python-OC-Lettings-FR.git`

#### Créer l'environnement virtuel

- `cd /path/to/Python-OC-Lettings-FR`
- `python -m venv venv`
- `apt-get install python3-venv` (Si l'étape précédente comporte des erreurs avec un paquet non trouvé sur Ubuntu)
- Activer l'environnement `source venv/bin/activate`
- Confirmer que la commande `python` exécute l'interpréteur Python dans l'environnement virtuel
`which python`
- Confirmer que la version de l'interpréteur Python est la version 3.6 ou supérieure `python --version`
- Confirmer que la commande `pip` exécute l'exécutable pip dans l'environnement virtuel, `which pip`
- Pour désactiver l'environnement, `deactivate`

#### Exécuter le site

- `cd /path/to/Python-OC-Lettings-FR`
- `source venv/bin/activate`
- `pip install --requirement requirements.txt`
- `python manage.py runserver`
- Aller sur `http://localhost:8000` dans un navigateur.
- Confirmer que le site fonctionne et qu'il est possible de naviguer (vous devriez voir plusieurs profils et locations).

#### Linting

- `cd /path/to/Python-OC-Lettings-FR`
- `source venv/bin/activate`
- `flake8 oc_lettings_site`

#### Tests unitaires

- `cd /path/to/Python-OC-Lettings-FR`
- `source venv/bin/activate`
- `pytest`

#### Base de données

- `cd /path/to/Python-OC-Lettings-FR`
- Ouvrir une session shell `sqlite3`
- Se connecter à la base de données `.open oc-lettings-site.sqlite3`
- Afficher les tables dans la base de données `.tables`
- Afficher les colonnes dans le tableau des profils, `PRAGMA table_info(oc_lettings_site_profile);`
- Lancer une requête sur la table des profils, `select user_id, favorite_city from
  oc_lettings_site_profile where favorite_city like 'B%';`
- `.quit` pour quitter

#### Panel d'administration

- Aller sur `http://localhost:8000/admin`
- Connectez-vous avec l'utilisateur `admin`, mot de passe `Abc1234!`

### Windows

Utilisation de PowerShell, comme ci-dessus sauf :

- Pour activer l'environnement virtuel, `.\venv\Scripts\Activate.ps1` 
- Remplacer `which <my-command>` par `(Get-Command <my-command>).Path`

#### Déploiement

Ce projet utilise :
- Docker pour containeriser l’application
- GitHub Actions pour automatiser les tests, le linting, la création de l'image
- Render pour héberger le service
- Sentry pour la surveillance des erreurs.


Docker permet de construire et exécuter l’application de façon cohérente sur tous les environnements.
GitHub Actions déclenche les tests, construit et pousse l’image Docker automatiquement sur Docker Hub à chaque modification.
Render déploie et héberge l’application à partir de l’image Docker présente sur Docker Hub.
Sentry collecte et alerte sur les erreurs en production pour faciliter la maintenance.

### Étapes de déploiement

Construire et tester localement :

`docker build -t utilisateur/oc-lettings-site:latest .`
`docker run -p 8000:8000 -e SECRET_KEY=secret -e DEBUG=0 utilisateur/oc-lettings-site:latest`

Pousser l’image sur Docker Hub :

`docker login`
`docker push utilisateur/oc-lettings-site:latest`

Configurer Render :

- Créer un nouveau service web en choisissant le type « Docker ».
- Indiquer l’URL de l’image Docker Hub.
- Ajouter les variables d'environnement (SECRET_KEY, SENTRY_DSN)
- Déployer la version la plus récente.
